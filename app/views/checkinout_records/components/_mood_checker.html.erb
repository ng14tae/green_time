<div class="mt-6" data-controller="mood-checker" data-mood-checker-record-id-value="<%= record.id %>">
    <%
        is_disabled = defined?(disabled) && disabled
        is_mood_success = defined?(show_mood_success) && show_mood_success
        is_comment_success = defined?(show_comment_success) && show_comment_success
    %>

    <!-- チェックイン前メッセージ -->
    <% if is_disabled %>
        <p class="text-center text-yellow-200 mb-4">⏰ チェックイン後に気分を記録できます</p>
    <% end %>

    <!-- 記録済みメッセージ -->
    <% if is_mood_success || is_comment_success %>
        <p class="text-center text-green-500 mb-4">
        記録されました！チェックアウトする前までは編集できます！
        </p>
    <% end %>

    <!-- 気分選択 -->
    <div class="mb-6">
        <p class="text-lg mb-3">今の気分を教えてください 🌤️（任意）</p>
        <div class="flex justify-center gap-4">
        <% %w[happy neutral sad].each do |feeling| %>
            <% emoji, label = MoodsHelper::FEELING_MAP[feeling].values_at(:label, :value) %>
            <button
            data-action="click->mood-checker#select"
            data-mood="<%= feeling %>"
            class="mood-btn px-4 py-2 rounded transition-all
                    <%=
                    'bg-green-400 hover:bg-green-500 text-white' if feeling == 'happy'
                    %>
                    <%=
                    'bg-yellow-400 hover:bg-yellow-500 text-white' if feeling == 'neutral'
                    %>
                    <%=
                    'bg-blue-400 hover:bg-blue-500 text-white' if feeling == 'sad'
                    %>
                    <%= 'mood-selected' if record.mood&.feeling == feeling %>"
            >
            <%= "#{emoji} #{label}" %>

            </button>
        <% end %>
        </div>

        <!-- 気分状態表示 -->
        <div data-mood-checker-target="moodStatus" class="text-center mt-2 hidden"></div>
    </div>

    <!-- 気分メモ -->
    <div>
        <p class="text-lg mb-3 py-2">💭 気分メモ（任意）</p>
        <textarea
        data-mood-checker-target="comment"
        placeholder="今の気分について詳しく書いてみませんか？"
        class="textarea textarea-bordered w-full bg-white resize-none"
        rows="3"
        maxlength="140"
        ><%= record.mood&.comment %></textarea>

        <div class="flex justify-between items-center mt-2 mb-4">
        <div data-mood-checker-target="commentStatus" class="text-sm text-green-600 hidden"></div>
        <div class="text-sm text-gray-300">
            <span data-mood-checker-target="counter"><%= record.mood&.comment&.length || 0 %></span>/140
        </div>
        </div>

        <button
        data-action="click->mood-checker#saveComment"
        data-mood-checker-target="saveButton"
        class="btn btn-secondary w-full text-error"
        >
        メモを記録する（任意）
        </button>
    </div>
</div>
