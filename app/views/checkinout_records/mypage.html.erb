<div class="hero min-h-screen bg-gradient-to-br from-green-400 via-emerald-500 to-teal-600">
    <div class="container mx-auto px-4">

        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <div class="text-center text-white mb-8 pt-12">
        <h1 class="text-4xl font-bold mb-4">„Éû„Ç§„Éö„Éº„Ç∏</h1>
        <p class="text-xl"><%= current_user.email %>„Åï„Çì„ÅÆÂã§ÊÄ†Ë®òÈå≤</p>
        </div>

        <!-- „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
        <div class="text-center mb-8">
        <%= link_to "„Éõ„Éº„É†„Å´Êàª„Çã", root_path,
            class: "bg-white text-amber-700 px-6 py-3 rounded-lg font-bold hover:bg-gray-100 transition-colors mr-4" %>

        <% if @today_record %>
            <%= link_to "„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà", checkout_page_checkinout_records_path,
                class: "bg-orange-800 text-white px-6 py-3 rounded-lg font-bold hover:bg-red-600 transition-colors mr-4" %>
        <% else %>
            <%= link_to "„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥", checkin_page_checkinout_records_path,
                class: "bg-primary text-white px-6 py-3 rounded-lg font-bold hover:bg-indigo-600 transition-colors mr-4" %>
        <% end %>

        <%= link_to "Ê∞óÂàÜ„Ç∞„É©„Éï", analytics_moods_path,
            class: "bg-white text-amber-700 px-6 py-3 rounded-lg font-bold hover:bg-gray-100 transition-colors mr-4" %>
        </div>

        <!-- Áµ±Ë®à„Ç´„Éº„Éâ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">

        <!-- ‰ªäÊó•„ÅÆÁä∂Ê≥Å -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="text-center">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">‰ªäÊó•</h2>
            <% if @today_record %>
                <p class="text-green-600 font-bold text-xl mb-2">Âã§Âãô‰∏≠</p>
                <p class="text-gray-600">
                ÈñãÂßã: <%= @today_record.checkin_time.strftime("%H:%M") %>
                </p>
                <p class="text-sm text-gray-500 mt-2">
                ÁµåÈÅéÊôÇÈñì: <span id="elapsed-time"></span>
                </p>
            <% else %>
                <% todays_completed = CheckinoutRecord.where(
                    user_id: current_user.id,
                    checkin_time: Time.current.beginning_of_day..Time.current.end_of_day
                ).where.not(checkout_time: nil).first %>

                <% if todays_completed %>
                <p class="text-blue-600 font-bold text-xl mb-2">Âã§ÂãôÂÆå‰∫Ü</p>
                <p class="text-gray-600">
                    <%= sprintf("%.1fÊôÇÈñì", (todays_completed.checkout_time - todays_completed.checkin_time) / 3600.0) %>
                </p>
                <p class="text-sm text-gray-500">
                    <%= todays_completed.checkin_time.strftime("%H:%M") %> -
                    <%= todays_completed.checkout_time.strftime("%H:%M") %>
                </p>
                <% else %>
                <p class="text-gray-600 text-xl">Êú™Âã§Âãô</p>
                <p class="text-sm text-gray-500">„Åæ„Å†„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                <% end %>
            <% end %>
            </div>
        </div>

        <!-- ‰ªäÈÄ±„ÅÆÁµ±Ë®à -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="text-center">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">‰ªäÈÄ±</h2>
            <p class="text-3xl font-bold text-blue-600 mb-2">
                <%= @weekly_stats[:total_days] %>Êó•
            </p>
            <p class="text-gray-600 mb-2">
                <%= sprintf("%.1fÊôÇÈñì", @weekly_stats[:total_hours]) %>
            </p>
            <p class="text-sm text-gray-500">
                <%= Date.current.beginning_of_week.strftime("%m/%d") %> -
                <%= Date.current.end_of_week.strftime("%m/%d") %>
            </p>
            </div>
        </div>

        <!-- ‰ªäÊúà„ÅÆÁµ±Ë®à -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="text-center">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">‰ªäÊúà</h2>
            <p class="text-3xl font-bold text-purple-600 mb-2">
                <%= @monthly_stats[:total_days] %>Êó•
            </p>
            <p class="text-gray-600 mb-2">
                <%= sprintf("%.1fÊôÇÈñì", @monthly_stats[:total_hours]) %>
            </p>
            <p class="text-sm text-gray-500">
                Âπ≥Âùá: <%= sprintf("%.1f", @monthly_stats[:average_hours]) %>ÊôÇÈñì/Êó•
            </p>
            </div>
        </div>
        </div>

        <!-- Âã§ÊÄ†Ë®òÈå≤‰∏ÄË¶ß -->
        <% if @recent_records.any? %>
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">ÊúÄËøë„ÅÆÂã§ÊÄ†Ë®òÈå≤</h2>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b-2 border-gray-200">
                                <th class="text-left py-3 px-4 font-bold text-gray-700">Êó•‰ªò</th>
                                <th class="text-left py-3 px-4 font-bold text-gray-700">„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥</th>
                                <th class="text-left py-3 px-4 font-bold text-gray-700">„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà</th>
                                <th class="text-left py-3 px-4 font-bold text-gray-700">Âä¥ÂÉçÊôÇÈñì</th>
                                <th class="text-left py-3 px-4 font-bold text-gray-700">Ê∞óÂàÜ</th>
                                <th class="text-left py-3 px-4 font-bold text-gray-700">„É°„É¢</th>
                                <th class="text-left py-3 px-4 font-bold text-gray-700">Áä∂ÊÖã</th>
                            </tr>
                        </thead>
                    <tbody>
                        <% @recent_records.each do |record| %>
                            <tr class="border-b border-gray-100 hover:bg-gray-50">
                            <td class="py-3 px-4">
                                <%= record.checkin_time.strftime("%Y/%m/%d (%a)") %>
                            </td>
                            <td class="py-3 px-4">
                                <%= record.checkin_time.strftime("%H:%M") %>
                            </td>
                            <td class="py-3 px-4">
                                <% if record.checkout_time %>
                                <%= record.checkout_time.strftime("%H:%M") %>
                                <% else %>
                                <span class="text-red-500 font-bold">Âã§Âãô‰∏≠</span>
                                <% end %>
                            </td>
                            <td class="py-3 px-4">
                                <% if record.checkout_time %>
                                <span class="text-green-600 font-bold">
                                    <%= sprintf("%.1fÊôÇÈñì", (record.checkout_time - record.checkin_time) / 3600.0) %>
                                </span>
                                <% else %>
                                <span class="text-orange-500">-</span>
                                <% end %>
                            </td>

                    <!-- Ê∞óÂàÜÊ¨Ñ -->
                    <td class="py-3 px-4">
                        <% if record.mood&.feeling.present? %>
                            <span class="text-2xl"><%= record.mood.mood_emoji %></span>
                        <% else %>
                            <span class="text-gray-400 text-sm">Êú™Ë®òÈå≤</span>
                        <% end %>
                    </td>

                    <!-- „É°„É¢Ê¨ÑÔºàÊñ∞„Åó„ÅèËøΩÂä†Ôºâ -->
                    <td class="py-3 px-4">
                        <% if record.has_mood? && record.mood.comment.present? %>
                            <div class="max-w-xs">
                                <% if record.mood.comment.length > 50 %>
                                    <p class="text-sm text-gray-700" title="<%= record.mood.comment %>">
                                        <%= truncate(record.mood.comment, length: 50) %>
                                    </p>
                                    <button class="text-xs text-blue-500 hover:text-blue-700" onclick="showFullComment(this)">
                                        „ÇÇ„Å£„Å®Ë¶ã„Çã
                                    </button>
                                    <div class="hidden full-comment">
                                        <p class="text-sm text-gray-700"><%= simple_format(record.mood.comment) %></p>
                                    </div>
                                <% else %>
                                    <p class="text-sm text-gray-700"><%= record.mood.comment %></p>
                                <% end %>
                            </div>
                        <% else %>
                            <span class="text-gray-400 text-sm">-</span>
                        <% end %>
                    </td>

                    <td class="py-3 px-4">
                        <% if record.checkout_time %>
                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm">ÂÆå‰∫Ü</span>
                        <% else %>
                        <span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-sm">Âã§Âãô‰∏≠</span>
                        <% end %>
                    </td>
                    </tr>
                <% end %>
                </tbody>
            </table>
            </div>


                </div>
                <% else %>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="text-center py-8">
                    <p class="text-gray-500 text-lg">„Åæ„Å†Âã§ÊÄ†Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                    <p class="text-gray-400 text-sm mt-2">„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥„Åó„Å¶Ë®òÈå≤„ÇíÈñãÂßã„Åó„Åæ„Åó„Çá„ÅÜÔºÅ</p>
                    </div>
                </div>
                <% end %>

                <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ -->
                <div class="flex justify-center mt-6">
                    <%= paginate @recent_records %>
                    </div>

        <!-- „Éï„ÉÉ„Çø„Éº -->
        <div class="text-center mt-8 py-8">
        <p class="text-white text-sm">üí™ „ÅäÁñ≤„Çå„Åï„Åæ„Åß„Åó„ÅüÔºÅ„Åà„Çâ„ÅÑÔºÅ</p>
        </div>
    </div>
    </div>

    <!-- Âã§Âãô‰∏≠„ÅÆÂ†¥Âêà„ÅÆÁµåÈÅéÊôÇÈñìË°®Á§∫Áî®JavaScript -->
    <% if @today_record %>
    <script>
    function updateElapsedTime() {
        const checkinTime = new Date('<%= @today_record.checkin_time.iso8601 %>');
        const now = new Date();
        const elapsed = Math.floor((now - checkinTime) / 1000); // ÁßíÂçò‰Ωç

        const hours = Math.floor(elapsed / 3600);
        const minutes = Math.floor((elapsed % 3600) / 60);

        document.getElementById('elapsed-time').textContent =
        hours + 'ÊôÇÈñì' + minutes + 'ÂàÜ';
    }

    // ÂàùÂõûÂÆüË°å
    updateElapsedTime();

    // 1ÂàÜ„Åî„Å®„Å´Êõ¥Êñ∞
    setInterval(updateElapsedTime, 60000);
</script>
<% end %>