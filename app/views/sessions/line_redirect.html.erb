<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-400 to-blue-500">
    <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full mx-4">
        <div class="text-center">
        <h1 class="text-2xl font-bold text-gray-800 mb-4">
            ğŸŒ± æ´»å‹•æ™‚é–“è¨˜éŒ²ã‚¢ãƒ—ãƒª
        </h1>

        <p class="text-gray-600 mb-6">
            LINEã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦<br>
            ã‚ãªãŸã®æ¤ç‰©ã‚’è‚²ã¦ã¾ã—ã‚‡ã†ï¼
        </p>

        <button id="line-login-btn"
                class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
            ğŸ“± LINEã§ãƒ­ã‚°ã‚¤ãƒ³
        </button>

        <div id="loading" class="hidden mt-4">
            <p class="text-gray-500">ãƒ­ã‚°ã‚¤ãƒ³ä¸­...</p>
        </div>
        </div>
    </div>
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
    // LIFFåˆæœŸåŒ–
    liff.init({
        liffId: '<%= Rails.application.credentials.line[:liff_id] %>'
    }).then(() => {
        console.log('LIFFåˆæœŸåŒ–å®Œäº†');

        document.getElementById('line-login-btn').addEventListener('click', function() {
        if (!liff.isLoggedIn()) {
            liff.login();
        } else {
            performLogin();
        }
        });

        // æ—¢ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆã¯è‡ªå‹•å®Ÿè¡Œ
        if (liff.isLoggedIn()) {
        performLogin();
        }
    }).catch((err) => {
        console.error('LIFFåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', err);
    });

    function performLogin() {
        document.getElementById('loading').classList.remove('hidden');

        const accessToken = liff.getAccessToken();

        fetch('/auth/liff_login', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            access_token: accessToken
        })
        })
        .then(response => response.json())
        .then(data => {
        if (data.success) {
            window.location.href = data.redirect_url;
        } else {
            alert('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + data.error);
            document.getElementById('loading').classList.add('hidden');
        }
        })
        .catch(error => {
        console.error('ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:', error);
        alert('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ');
        document.getElementById('loading').classList.add('hidden');
        });
    }
});
</script>