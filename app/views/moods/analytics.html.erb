<div class="hero min-h-screen bg-gradient-to-br from-green-400 via-emerald-500 to-teal-600">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">

        <!-- ページタイトル -->
        <div class="text-center text-white mb-8 sm:mb-12 pt-12 sm:pt-16">
        <h1 class="text-3xl sm:text-4xl font-bold mb-2">気分の分析</h1>
        <p class="text-white/80 text-sm sm:text-base">あなたの気分の傾向を見てみましょう</p>
        </div>

        <!-- 統計カード -->
<div class="stats shadow mb-6 w-full bg-base-100 grid grid-cols-1 sm:grid-cols-3 divide-y sm:divide-y-0 sm:divide-x divide-base-200">
  <% moods = [
    { emoji: "😊", title: "ハッピーな日", count: @mood_counts["happy"] || 0, color: "text-success" },
    { emoji: "😐", title: "普通の日", count: @mood_counts["neutral"] || 0, color: "" },
    { emoji: "😢", title: "悲しい日", count: @mood_counts["sad"] || 0, color: "text-error" }
  ] %>

  <% moods.each do |m| %>
    <div class="stat flex flex-col items-center justify-center p-4">
      <!-- 絵文字ボックス -->
      <div class="flex items-center justify-center w-12 h-12 sm:w-14 sm:h-14 text-3xl sm:text-4xl mb-1 leading-none">
        <%= m[:emoji] %>
      </div>
      <div class="stat-title text-sm sm:text-base"><%= m[:title] %></div>
      <div class="stat-value <%= m[:color] %> text-2xl sm:text-3xl font-bold"><%= m[:count] %></div>
      <div class="stat-desc text-xs sm:text-sm text-base-content/70">総記録数</div>
    </div>
  <% end %>
</div>



        <!-- グラフエリア -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- 気分の分布（円グラフ） -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
            <h2 class="card-title text-lg sm:text-xl">気分の分布</h2>
            <%= pie_chart mood_data_for_pie(@mood_counts),
                colors: ["#10b981", "#6b7280", "#ef4444"],
                height: "300px",
                library: {
                    backgroundColor: 'transparent',
                    plugins: {
                    legend: {
                        labels: {
                        color: 'hsl(var(--bc))',
                        font: { family: 'Inter, system-ui, sans-serif' }
                        }
                    }
                    }
                } %>
            </div>
        </div>

        <!-- 週間トレンド（線グラフ） -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
            <h2 class="card-title text-lg sm:text-xl">週間記録数</h2>
            <%= line_chart @weekly_trend,
                height: "300px",
                colors: ["#3b82f6"],
                suffix: "回",
                library: {
                    backgroundColor: 'transparent',
                    plugins: {
                    legend: { labels: { color: 'hsl(var(--bc))' } }
                    },
                    scales: {
                    x: { ticks: { color: 'hsl(var(--bc))' } },
                    y: { ticks: { color: 'hsl(var(--bc))' } }
                    }
                } %>
            </div>
        </div>
        </div>

        <!-- 日別気分推移 -->
        <div class="card bg-base-100 shadow-xl mt-6">
        <div class="card-body">
            <h2 class="card-title text-lg sm:text-xl mb-2">直近7日間の気分推移</h2>
            <%= line_chart mood_data_for_daily(@daily_moods),
                height: "350px",
                colors: ["#10b981", "#6b7280", "#ef4444"],
                library: {
                backgroundColor: 'transparent',
                plugins: {
                    legend: { labels: { color: 'hsl(var(--bc))' } }
                },
                scales: {
                    x: { ticks: { color: 'hsl(var(--bc))' } },
                    y: { ticks: { color: 'hsl(var(--bc))' } }
                }
                } %>
        </div>
        </div>

        <!-- 戻るボタン -->
        <div class="text-center mt-8 sm:mt-12 py-6 sm:py-8">
        <%= link_to "マイページに戻る", mypage_checkinout_records_path, class: "btn btn-primary w-full sm:w-auto" %>
        </div>

    </div>
</div>

<script>
    console.log('Chartkick:', typeof Chartkick);
    console.log('Chart:', typeof Chart);
</script>